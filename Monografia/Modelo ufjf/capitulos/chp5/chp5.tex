

Agora utilizando todos os métodos estudados até aqui, será desenvolvida uma estrutura capaz de estimar as frequências presentes no sinal e suas relevâncias, e em seguida rastrear estas componentes por tempo indeterminado. Para tanto se fará uso da predição linear do capítulo anterior e posteriormente da estrutura PLL-Multitaxa. 

\section{PLL-M em partículas}

Foi realizada, a cargo de comparação, uma simulação com sinal nas mesmas condições da presente no capítulo anterior. Para tentar extrair os parâmetros das senoides, se inicializa PLLs em diferentes frequências, correspondentes aos harmônicos de 1 a 10. Desta maneira obtém-se o resultado visto na figura \ref{fig:pll_comp}.

\begin{figure}[H]
	\centering    
	\def\svgwidth{\columnwidth}
	\input{images/pll_comp.pdf_tex}
	\caption{Estimação de amplitudes com PLL-M}
	\label{fig:pll_comp}
\end{figure}

Nesta figura, observa-se que os harmônicos 1, 3 e 5 são corretamente rastreados, entretanto esta abordagem não é capaz de encontrar os inter-harmônicos em 152 Hz e 266 Hz. Também se percebe que ela é extremamente ineficaz uma vez que foram usados dez PLLs para rastrear cinco frequências e ainda assim não é possível encontrar duas delas.

\subsection{Estimação de Frequências}

Para solucionar o problema encontrado na seção anterior, vamos utilizar um método de estimação de frequências, assim poderemos saber onde inicializar os PLLs, aproveitando recursos computacionais. O RLS será usado para calcular os coeficientes $w_m$ de predição linear, faremos uma varredura da porção inicial do sinal aproveitando a grande velocidade de convergência. Para lidar com a desordem da estimação causada pelo RLS, utilizaremos o classificador do capítulo anterior, com uma adição: vamos filtrá-las de acordo com a variância das últimas $N$ amostras. Foi observado que as frequências corretas variam muito pouco dentro do classificador, diferente dos falsos positivos. Nos testes observamos diferença de pelo menos uma ordem de magnitude entre a variância de frequências corretas e falsas.

Passos para estimar as frequências:

\begin{enumerate}
	\item Usar o RLS para estimar $\boldsymbol{w}$.
	\item Calcular as raízes de $Q(z)=1-\sum_{m=1}^{M}w_m \, z^{-m}$
	\item Calcular as frequências e módulos usando as equações [obs: colocar as equações da seção 2].
	\item Usar o classificador e os estimadores já mencionados para encontrar as frequências, calcular a variância destas frequências e filtrá-las, ficando com os menores valores.
	\item Enviar as frequências encontradas para inicializar o PLL.  
\end{enumerate}
	
\subsection{PLL-Multitaxa}
A estrutura usada será idêntica à vista no final do capítulo 3. Tendo como única alteração as constantes, que serão $\mu=\{100, 5000, 400\}$.

\subsection{simulação e análise qualitativa}
Realizaremos a mesma simulação do artigo \cite{chang2009two}, entretanto com algumas alterações para forçar mais a estabilidade do algoritmo, em $t=2.5 \, s$ aplicaremos um degrau de 1 Hz na frequência fundamental, ao invés de 0.2 Hz, e o ruído presente será de variância $\sigma=0.05$ ao invés de 0.01. Usaremos M=64, e $fs=128f_0$, entretanto a frequência de amostragem será abaixada em 2 vezes para a estimação das frequências para diminuir o tempo de computação, uma vez que neste problema em geral não se investiga frequências acima do 15º harmônico. Usaremos coeficiente de esquecimento igual a 0.92 para o RLS. Escolheremos também rastrear as componentes julgadas mais energéticas pelo estimador. Para o classificador utilizaremos $\lambda=0.1$ na classificação de frequências e umbral da variância igual a 5, ou seja, somente rastrearemos as componentes cuja variância das últimas 100 amostras for menor que 5. 

Rodamos o RLS por meio segundo de sinal, onde devemos admitir que este mantém suas características estatísticas.

\begin{figure}[H]
	\centering    
	\def\svgwidth{\columnwidth}
	\input{images/estagio_1.pdf_tex}
	\caption{Estágio de estimação de frequências e ordem do sistema}
	\label{fig:estagio_1}
\end{figure}

Podemos observar na figura \ref{fig:estagio_1} o estágio de estimação de frequências e ordem do sistema, identificando as cinco componentes desejadas. Observa-se também que ele converge para estas cinco componentes em aproximadamente 100 ms. A partir deste momento já temos os valores corretos estabilizados e adequados para passarmos ao próximo estágio, de rastreio de frequência e amplitude. 

\indent No rastreio de amplitudes vemos que o PLL segue as componentes de maneira rápida, eficaz e estável, apesar de mudanças na frequência fundamental, na amplitude dos harmônicos e quando os dois ocorrem ao mesmo tempo. Entretanto observa-se um batimento nas estimações da frequência errante de 152 Hz e também no 5º e 3º harmônicos depois do degrau de 1 Hz en 2.5 s. Isto se deve à principalmente a interferências, uma vez que eles acabam ficando próximos, mas não leva a offset na estimação.

\indent Percebe-se que a estimação fina de frequências do PLL-M que é muito mais precisa e estável que a do primeiro estágio, embora esta não seja global. Se por exemplo, uma destas componentes deixa de existir, some do sinal, o PLL não tem condições de acusar isto, ou se uma nova aparece no ligar da antiga, o PLL também não poderia identificá-la.

\begin{figure}[H]
	\centering    
	\def\svgwidth{\columnwidth}
	\input{images/amplitudes.pdf_tex}
	\caption{rastreio de amplitudes do PLL-M}
	\label{fig:rastreio_final}
\end{figure}

\begin{figure}[H]
	\centering    
	\def\svgwidth{\columnwidth}
	\input{images/freq_grande.pdf_tex}
	\caption{Rastreio de frequências do PLL-M}
	\label{fig:amplitudes}
\end{figure}
\begin{figure}[H]
	\centering    
	\def\svgwidth{\columnwidth}
	\input{images/amp_grande.pdf_tex}
	\caption{Rastreio de frequências do PLL-M}
	\label{fig:amplitudes}
\end{figure}


\section{Conclusões}

Neste trabalho apresentamos o que é e o problema que representa hoje a estimação espectral, bem como a fundamentação teórica matemática por trás do tema. Discorremos sobre métodos paramétricos e não paramétricos. Nos focamos principalmente em simular e apresentar alternativas para duas metodologias relativamente recentes, publicadas nos últimos 10 anos. 

Apresentamos as virtudes e pontos fracos de cada um dos métodos, ao final do trabalho é proposto um método capaz de unir os pontos fortes de cada um. Aproveitando a robustez e simplicidade computacional no rastreio do PLL-M e o poder de identificação global dos métodos baseados em modelos AR. Entretanto, mesmo dentro da metodologia aplicada ao capítulo final, há muito o que se desenvolver. Um método mais robusto seria capaz de identificar o surgimento de novas componentes e o desaparecimento de outras, fazendo uma administração inteligente dos recursos computacionais. 
